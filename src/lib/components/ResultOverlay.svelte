<script>
  import moment from "moment-timezone";

  // Simple function to convert title to URL slug
  function titleToSlug(title) {
    return title?.toLowerCase().replace(/[^a-z0-9]/g, "") || "";
  }

  let {
    time,
    isCorrect,
    onClose,
    hideKeyboard,
    isArchiveMode = false,
    isThemedMode = false,
    puzzleTitle = null,
    words = [], // Accept words prop, remove placeholder songs
    selectedDate,
    totalLetterCount = null,
    foundLetterCount = null,
    revealedLetterCount = null,
    onNavigateBack = null,
  } = $props();

  // Add state for track metadata
  let trackMetadata = $state({});
  console.log(totalLetterCount);
  console.log(foundLetterCount);
  console.log(revealedLetterCount);

  // Function to get track info from widget
  function getTrackInfoFromWidget(word) {
    const widgetId = `${word.startX}:${word.startY}:${word.direction}`;
    const iframe = document.getElementById(widgetId);

    if (!iframe) {
      console.warn("Widget iframe not found:", widgetId);
      trackMetadata[word.audioUrl] = {
        title: "Unknown Track",
        artist: "Unknown Artist",
      };
      return;
    }

    // Wait for the widget to be ready
    setTimeout(() => {
      try {
        const widget = SC.Widget(iframe);
        widget.bind(SC.Widget.Events.READY, () => {
          widget.getCurrentSound((sound) => {
            if (sound) {
              console.log("Loaded sound:", sound);
              trackMetadata[word.audioUrl] = {
                title: sound.title,
                artist: sound.user.username,
              };
            } else {
              console.warn("No sound data received for:", word.audioUrl);
              trackMetadata[word.audioUrl] = {
                title: "Unknown Track",
                artist: "Unknown Artist",
              };
            }
          });
        });
      } catch (error) {
        console.error("Error getting track info:", error);
        trackMetadata[word.audioUrl] = {
          title: "Unknown Track",
          artist: "Unknown Artist",
        };
      }
    }, 1000); // Wait 1 second for widget to initialize
  }

  // Get track info for all words when component mounts
  $effect(() => {
    if (words.length > 0) {
      console.log("Loading track info for words:", words);
      words.forEach((word) => {
        getTrackInfoFromWidget(word);
      });
    }
  });

  // Add state for share message
  let showShareMessage = $state(false);

  // Check if device is mobile
  let isMobile = $state(false);

  $effect(() => {
    isMobile = window.matchMedia("(max-width: 768px)").matches;
  });

  // Function to play a track preview
  function playTrackPreview(word) {
    const widgetId = `${word.startX}:${word.startY}:${word.direction}`;
    const iframe = document.getElementById(widgetId);
    if (iframe) {
      const widget = SC.Widget(iframe);
      widget.play();
    }
  }

  // Function to open track in SoundCloud
  function openTrackInSoundCloud(trackId) {
    window.open(
      `https://w.soundcloud.com/player/?url=https%3A//api.soundcloud.com/tracks/${trackId}`,
      "_blank"
    );
  }

  // Convert time (in seconds) to MM:SS format
  function formatTime(totalSeconds) {
    const minutes = Math.floor(totalSeconds / 60);
    const seconds = totalSeconds % 60;
    return `${minutes}:${seconds.toString().padStart(2, "0")}`;
  }

  // For countdown to midnight EST
  let timeUntilMidnight = $state("");
  let countdown;

  // Update countdown timer every second
  function startCountdown() {
    // Initial update
    updateCountdown();

    // Set interval for updates
    countdown = setInterval(updateCountdown, 1000);

    // Cleanup on component destroy
    return () => {
      if (countdown) clearInterval(countdown);
    };
  }

  function updateCountdown() {
    // Get current date in EST
    const now = new Date();
    const estTimeString = new Date().toLocaleString("en-US", {
      timeZone: "America/New_York",
    });
    const estTime = new Date(estTimeString);

    // Set target to next midnight EST
    const tomorrow = new Date(estTime);
    tomorrow.setDate(tomorrow.getDate() + 1);
    tomorrow.setHours(0, 0, 0, 0);

    // Calculate difference in hours, minutes and seconds
    const diff = tomorrow - estTime;
    const hours = Math.floor(diff / (1000 * 60 * 60));
    const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
    const seconds = Math.floor((diff % (1000 * 60)) / 1000);

    timeUntilMidnight = `${hours.toString().padStart(2, "0")}:${minutes.toString().padStart(2, "0")}:${seconds.toString().padStart(2, "0")}`;
  }

  // Function to get puzzle number based on date
  function getPuzzleNumber(date = null) {
    // April 29th, 2024 was the first puzzle (in Eastern Time)
    const firstPuzzleDate = moment.tz("2025-04-29", "America/New_York");
    const targetDate = date
      ? moment.tz(date, "America/New_York")
      : moment.tz("America/New_York");

    // Calculate difference in days
    const diffDays = targetDate.diff(firstPuzzleDate, "days");

    return diffDays + 1; // Add 1 since April 29th was #1
  }

  // Copy results to clipboard
  function shareResults() {
    const puzzleNumber = isArchiveMode
      ? getPuzzleNumber(selectedDate)
      : getPuzzleNumber();
    const today = moment.tz("America/New_York");
    const formattedDate = today.format("MMMM Do");

    let resultText;
    if (revealedLetterCount === 0) {
      resultText = `I solved the puzzle in ${formatTime(time)} flawlessly âœ….`;
    } else {
      resultText = `I solved the puzzle in ${formatTime(time)} and revealed ${revealedLetterCount} ${revealedLetterCount === 1 ? "letter" : "letters"}.`;
    }

    let shareText;
    if (isThemedMode && puzzleTitle) {
      let themedUrl = "crosstune.io/themed";
      if (puzzleTitle) {
        // Use clean slug-based URL
        const puzzleSlug = titleToSlug(puzzleTitle);
        themedUrl = `crosstune.io/themed/${puzzleSlug}`;
      }
      shareText = `Crosstune - ${puzzleTitle}\n\n${resultText}\n\n${themedUrl}`;
    } else if (isArchiveMode) {
      shareText = `Crosstune #${puzzleNumber} - ${selectedDate ? moment(selectedDate).format("MMMM Do") : formattedDate} (Archive)\n\n${resultText}\n\ncrosstune.io`;
    } else {
      shareText = `Crosstune #${puzzleNumber} - ${formattedDate}\n\n${resultText}\n\ncrosstune.io`;
    }

    if (isMobile && navigator.share) {
      navigator
        .share({
          title: "Crosstune Results",
          text: shareText,
        })
        .catch((err) => {
          copyToClipboard(shareText);
        });
    } else {
      copyToClipboard(shareText);
    }
  }

  function copyToClipboard(text) {
    navigator.clipboard
      .writeText(text)
      .then(() => {
        showShareMessage = true;
        setTimeout(() => {
          showShareMessage = false;
        }, 2000);
      })
      .catch((err) => {
        console.error("Failed to copy: ", err);
      });
  }

  // Hide the keyboard when overlay is shown
  $effect(() => {
    if (hideKeyboard) hideKeyboard();
    const cleanup = startCountdown();
    return cleanup;
  });

  // Prevent body scroll when overlay is active
  $effect(() => {
    if (isCorrect) {
      document.body.style.overflow = "hidden";
    }

    // Cleanup function to restore scrolling when component unmounts or isCorrect becomes false
    return () => {
      document.body.style.overflow = ""; // Reset to default
    };
  });
</script>

<div
  class="fixed inset-0 z-50 flex items-start justify-center pt-16 pb-16 text-white"
>
  {#if isCorrect}
    <!-- Background gradient -->
    <div
      class="absolute inset-0 backdrop-blur-[2px]"
      style="background: linear-gradient(180deg, rgba(74, 74, 74, 0.75) 0%, #4A4A4A 59.02%);"
    ></div>

    <!-- Content -->
    <div
      class="relative z-10 flex flex-col items-center text-center max-w-md w-full mx-4 space-y-6 p-8 overflow-y-auto max-h-[calc(100vh-8rem)] scrollbar-thin scrollbar-thumb-gray-500 scrollbar-track-gray-700"
    >
      <!-- Exit button -->
      <button
        onclick={onClose}
        class="absolute top-3 right-3 text-gray-500 hover:text-gray-700"
        aria-label="Close"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          class="h-6 w-6"
          fill="none"
          viewBox="0 0 24 24"
          stroke="white"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M6 18L18 6M6 6l12 12"
          />
        </svg>
      </button>

      <h2 class="text-3xl font-bold text-white">Congratulations!</h2>
      <p class="text-xl text-white">
        {#if isArchiveMode}
          You solved the puzzle in {formatTime(time)}!
        {:else}
          You solved today's puzzle in {formatTime(time)}!
        {/if}
      </p>
      {#if totalLetterCount !== null && foundLetterCount !== null && revealedLetterCount !== null}
        <p class="text-lg text-white mt-2">
          {#if revealedLetterCount != 0}
            {foundLetterCount}/{totalLetterCount} letters found, {revealedLetterCount}
            revealed
          {:else}
            A flawless solve!
          {/if}
        </p>
      {/if}

      <button
        onclick={shareResults}
        class="w-3/4 bg-[#202020] hover:bg-[#101010] text-white font-bold py-3 px-6 rounded-lg transition-colors"
      >
        SHARE RESULT
      </button>

      {#if isThemedMode}
        <div class="text-center">
          <button
            onclick={onNavigateBack}
            class="text-blue-500 hover:underline text-md font-small bg-transparent border-none cursor-pointer"
          >
            Play another puzzle.
          </button>
        </div>
      {:else if isArchiveMode}
        <div class="text-center">
          <a
            href="/archives"
            class="text-blue-500 hover:underline text-md font-small"
          >
            Go back to archive.
          </a>
        </div>
      {:else}
        <div class="text-center">
          <p class="font-medium">Next puzzle in</p>
          <p class="text-xl font-bold">{timeUntilMidnight}</p>
        </div>
      {/if}

      {#if !isArchiveMode}
        <p class="text-sm text-white">
          Missed yesterday? Visit the <a
            href="/archives"
            class="text-blue-500 hover:underline">archive</a
          >.
        </p>
      {/if}

      <div class="flex flex-col gap-3 w-full text-white">
        <button
          class="w-3/4 mx-auto bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-6 rounded-lg transition-colors"
        >
          <a
            href="https://spotle.io"
            target="_blank"
            rel="noopener noreferrer"
            class="w-full py-3 transition-colors text-center"
          >
            PLAY SPOTLE
          </a>
        </button>

        <button
          class="w-3/4 mx-auto bg-[#BA81C2] hover:bg-[#9966a3] text-white font-bold py-3 px-6 rounded-lg transition-colors"
        >
          <a
            href="https://harmonies.io"
            target="_blank"
            rel="noopener noreferrer"
            class="w-full py-3 transition-colors text-center"
          >
            PLAY HARMONIES
          </a>
        </button>
      </div>

      <!-- START: SoundCloud Attribution Section -->
      <div class="w-full mt-6 pt-6 border-t border-gray-600 text-left">
        <!-- Powered by SoundCloud Placeholder -->
        <div class="mb-4 text-sm text-gray-400">
          <svg
            width="189"
            height="47"
            viewBox="0 0 189 47"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              d="M46.4266 23.0909V8.09091H48.5004V9.85938H48.678C48.8011 9.6321 48.9787 9.36932 49.2107 9.07102C49.4427 8.77273 49.7646 8.51231 50.1766 8.28977C50.5885 8.0625 51.133 7.94886 51.8101 7.94886C52.6908 7.94886 53.4768 8.1714 54.1681 8.61648C54.8593 9.06155 55.4015 9.70312 55.7945 10.5412C56.1922 11.3793 56.3911 12.3878 56.3911 13.5668C56.3911 14.7457 56.1946 15.7566 55.8016 16.5994C55.4086 17.4375 54.8688 18.0838 54.1823 18.5384C53.4957 18.9882 52.7121 19.2131 51.8314 19.2131C51.1685 19.2131 50.6264 19.1018 50.205 18.8793C49.7883 18.6567 49.4616 18.3963 49.2249 18.098C48.9881 17.7997 48.8058 17.5346 48.678 17.3026H48.5502V23.0909H46.4266ZM48.5075 13.5455C48.5075 14.3125 48.6188 14.9848 48.8414 15.5625C49.0639 16.1402 49.3859 16.5923 49.8073 16.919C50.2287 17.241 50.7448 17.402 51.3556 17.402C51.99 17.402 52.5203 17.2339 52.9465 16.8977C53.3726 16.5568 53.6946 16.0952 53.9124 15.5128C54.1349 14.9304 54.2462 14.2746 54.2462 13.5455C54.2462 12.8258 54.1373 12.1795 53.9195 11.6065C53.7064 11.0336 53.3844 10.5814 52.9536 10.25C52.5274 9.91856 51.9948 9.75284 51.3556 9.75284C50.74 9.75284 50.2192 9.91146 49.7931 10.2287C49.3717 10.5459 49.0521 10.9886 48.8343 11.5568C48.6164 12.125 48.5075 12.7879 48.5075 13.5455ZM63.3655 19.2202C62.3428 19.2202 61.4503 18.9858 60.6879 18.517C59.9256 18.0483 59.3338 17.3925 58.9124 16.5497C58.491 15.7069 58.2803 14.7221 58.2803 13.5952C58.2803 12.4635 58.491 11.474 58.9124 10.6264C59.3338 9.77888 59.9256 9.12074 60.6879 8.65199C61.4503 8.18324 62.3428 7.94886 63.3655 7.94886C64.3882 7.94886 65.2807 8.18324 66.0431 8.65199C66.8054 9.12074 67.3972 9.77888 67.8186 10.6264C68.24 11.474 68.4507 12.4635 68.4507 13.5952C68.4507 14.7221 68.24 15.7069 67.8186 16.5497C67.3972 17.3925 66.8054 18.0483 66.0431 18.517C65.2807 18.9858 64.3882 19.2202 63.3655 19.2202ZM63.3726 17.4375C64.0355 17.4375 64.5847 17.2623 65.0203 16.9119C65.4559 16.5616 65.7779 16.0952 65.9862 15.5128C66.1993 14.9304 66.3058 14.2888 66.3058 13.5881C66.3058 12.892 66.1993 12.2528 65.9862 11.6705C65.7779 11.0833 65.4559 10.6122 65.0203 10.2571C64.5847 9.90199 64.0355 9.72443 63.3726 9.72443C62.705 9.72443 62.151 9.90199 61.7107 10.2571C61.2751 10.6122 60.9507 11.0833 60.7377 11.6705C60.5293 12.2528 60.4252 12.892 60.4252 13.5881C60.4252 14.2888 60.5293 14.9304 60.7377 15.5128C60.9507 16.0952 61.2751 16.5616 61.7107 16.9119C62.151 17.2623 62.705 17.4375 63.3726 17.4375ZM72.8541 19L69.6439 8.09091H71.8385L73.9763 16.1023H74.0828L76.2277 8.09091H78.4223L80.553 16.0668H80.6595L82.7831 8.09091H84.9777L81.7746 19H79.6084L77.3925 11.1236H77.2291L75.0132 19H72.8541ZM91.3627 19.2202C90.2878 19.2202 89.3622 18.9905 88.5857 18.5312C87.8139 18.0672 87.2173 17.4162 86.7959 16.5781C86.3792 15.7353 86.1709 14.7481 86.1709 13.6165C86.1709 12.4991 86.3792 11.5142 86.7959 10.6619C87.2173 9.80966 87.8044 9.14441 88.5573 8.66619C89.3148 8.18797 90.2003 7.94886 91.2135 7.94886C91.829 7.94886 92.4256 8.05066 93.0033 8.25426C93.5809 8.45786 94.0994 8.77746 94.5587 9.21307C95.018 9.64867 95.3802 10.2145 95.6453 10.9105C95.9105 11.6018 96.0431 12.4422 96.0431 13.4318V14.1847H87.3712V12.5938H93.9621C93.9621 12.035 93.8485 11.5402 93.6212 11.1094C93.3939 10.6738 93.0743 10.3305 92.6624 10.0795C92.2552 9.8286 91.777 9.70312 91.2277 9.70312C90.6311 9.70312 90.1103 9.84991 89.6652 10.1435C89.2249 10.4323 88.884 10.8111 88.6425 11.2798C88.4057 11.7438 88.2874 12.2481 88.2874 12.7926V14.0355C88.2874 14.7647 88.4152 15.3849 88.6709 15.8963C88.9313 16.4077 89.2935 16.7983 89.7575 17.0682C90.2216 17.3333 90.7637 17.4659 91.384 17.4659C91.7864 17.4659 92.1534 17.4091 92.4848 17.2955C92.8163 17.1771 93.1027 17.0019 93.3442 16.7699C93.5857 16.5379 93.7703 16.2514 93.8982 15.9105L95.9081 16.2727C95.7471 16.8646 95.4583 17.383 95.0416 17.8281C94.6297 18.2685 94.1112 18.6117 93.4862 18.858C92.866 19.0994 92.1581 19.2202 91.3627 19.2202ZM98.3992 19V8.09091H100.452V9.82386H100.565C100.764 9.23674 101.115 8.77509 101.617 8.43892C102.123 8.09801 102.696 7.92756 103.335 7.92756C103.468 7.92756 103.624 7.93229 103.804 7.94176C103.989 7.95123 104.133 7.96307 104.237 7.97727V10.0085C104.152 9.98485 104.001 9.95881 103.783 9.9304C103.565 9.89725 103.347 9.88068 103.129 9.88068C102.627 9.88068 102.18 9.98722 101.787 10.2003C101.399 10.4086 101.091 10.6998 100.864 11.0739C100.636 11.4432 100.523 11.8646 100.523 12.3381V19H98.3992ZM110.386 19.2202C109.311 19.2202 108.386 18.9905 107.609 18.5312C106.837 18.0672 106.241 17.4162 105.819 16.5781C105.403 15.7353 105.194 14.7481 105.194 13.6165C105.194 12.4991 105.403 11.5142 105.819 10.6619C106.241 9.80966 106.828 9.14441 107.581 8.66619C108.338 8.18797 109.224 7.94886 110.237 7.94886C110.852 7.94886 111.449 8.05066 112.027 8.25426C112.604 8.45786 113.123 8.77746 113.582 9.21307C114.041 9.64867 114.404 10.2145 114.669 10.9105C114.934 11.6018 115.066 12.4422 115.066 13.4318V14.1847H106.395V12.5938H112.986C112.986 12.035 112.872 11.5402 112.645 11.1094C112.417 10.6738 112.098 10.3305 111.686 10.0795C111.279 9.8286 110.8 9.70312 110.251 9.70312C109.655 9.70312 109.134 9.84991 108.689 10.1435C108.248 10.4323 107.907 10.8111 107.666 11.2798C107.429 11.7438 107.311 12.2481 107.311 12.7926V14.0355C107.311 14.7647 107.439 15.3849 107.694 15.8963C107.955 16.4077 108.317 16.7983 108.781 17.0682C109.245 17.3333 109.787 17.4659 110.407 17.4659C110.81 17.4659 111.177 17.4091 111.508 17.2955C111.84 17.1771 112.126 17.0019 112.368 16.7699C112.609 16.5379 112.794 16.2514 112.922 15.9105L114.932 16.2727C114.771 16.8646 114.482 17.383 114.065 17.8281C113.653 18.2685 113.135 18.6117 112.51 18.858C111.889 19.0994 111.182 19.2202 110.386 19.2202ZM121.506 19.2131C120.626 19.2131 119.84 18.9882 119.149 18.5384C118.462 18.0838 117.922 17.4375 117.529 16.5994C117.141 15.7566 116.947 14.7457 116.947 13.5668C116.947 12.3878 117.143 11.3793 117.536 10.5412C117.934 9.70312 118.479 9.06155 119.17 8.61648C119.861 8.1714 120.645 7.94886 121.521 7.94886C122.198 7.94886 122.742 8.0625 123.154 8.28977C123.571 8.51231 123.893 8.77273 124.12 9.07102C124.352 9.36932 124.532 9.6321 124.66 9.85938H124.788V4.45455H126.911V19H124.837V17.3026H124.66C124.532 17.5346 124.347 17.7997 124.106 18.098C123.869 18.3963 123.542 18.6567 123.126 18.8793C122.709 19.1018 122.169 19.2131 121.506 19.2131ZM121.975 17.402C122.586 17.402 123.102 17.241 123.524 16.919C123.95 16.5923 124.272 16.1402 124.489 15.5625C124.712 14.9848 124.823 14.3125 124.823 13.5455C124.823 12.7879 124.714 12.125 124.497 11.5568C124.279 10.9886 123.959 10.5459 123.538 10.2287C123.116 9.91146 122.595 9.75284 121.975 9.75284C121.336 9.75284 120.803 9.91856 120.377 10.25C119.951 10.5814 119.629 11.0336 119.411 11.6065C119.198 12.1795 119.092 12.8258 119.092 13.5455C119.092 14.2746 119.201 14.9304 119.418 15.5128C119.636 16.0952 119.958 16.5568 120.384 16.8977C120.815 17.2339 121.345 17.402 121.975 17.402ZM135.406 19V4.45455H137.529V9.85938H137.657C137.78 9.6321 137.958 9.36932 138.19 9.07102C138.422 8.77273 138.744 8.51231 139.156 8.28977C139.568 8.0625 140.112 7.94886 140.789 7.94886C141.67 7.94886 142.456 8.1714 143.147 8.61648C143.838 9.06155 144.381 9.70312 144.774 10.5412C145.171 11.3793 145.37 12.3878 145.37 13.5668C145.37 14.7457 145.174 15.7566 144.781 16.5994C144.388 17.4375 143.848 18.0838 143.161 18.5384C142.475 18.9882 141.691 19.2131 140.81 19.2131C140.148 19.2131 139.605 19.1018 139.184 18.8793C138.767 18.6567 138.441 18.3963 138.204 18.098C137.967 17.7997 137.785 17.5346 137.657 17.3026H137.479V19H135.406ZM137.487 13.5455C137.487 14.3125 137.598 14.9848 137.82 15.5625C138.043 16.1402 138.365 16.5923 138.786 16.919C139.208 17.241 139.724 17.402 140.335 17.402C140.969 17.402 141.499 17.2339 141.926 16.8977C142.352 16.5568 142.674 16.0952 142.891 15.5128C143.114 14.9304 143.225 14.2746 143.225 13.5455C143.225 12.8258 143.116 12.1795 142.899 11.6065C142.685 11.0336 142.363 10.5814 141.933 10.25C141.506 9.91856 140.974 9.75284 140.335 9.75284C139.719 9.75284 139.198 9.91146 138.772 10.2287C138.351 10.5459 138.031 10.9886 137.813 11.5568C137.595 12.125 137.487 12.7879 137.487 13.5455ZM148.726 23.0909C148.409 23.0909 148.12 23.0649 147.859 23.0128C147.599 22.9654 147.405 22.9134 147.277 22.8565L147.788 21.1165C148.177 21.2206 148.522 21.2656 148.825 21.2514C149.128 21.2372 149.396 21.1236 149.628 20.9105C149.865 20.6974 150.073 20.3494 150.253 19.8665L150.516 19.142L146.524 8.09091H148.797L151.56 16.5568H151.673L154.436 8.09091H156.716L152.22 20.456C152.012 21.0241 151.747 21.5047 151.425 21.8977C151.103 22.2955 150.719 22.5938 150.274 22.7926C149.829 22.9915 149.313 23.0909 148.726 23.0909ZM160.111 19.1349C159.723 19.1349 159.389 18.9976 159.109 18.723C158.83 18.4437 158.69 18.1075 158.69 17.7145C158.69 17.3262 158.83 16.9948 159.109 16.7202C159.389 16.4408 159.723 16.3011 160.111 16.3011C160.499 16.3011 160.833 16.4408 161.112 16.7202C161.392 16.9948 161.531 17.3262 161.531 17.7145C161.531 17.9749 161.465 18.214 161.332 18.4318C161.205 18.6449 161.034 18.8153 160.821 18.9432C160.608 19.071 160.371 19.1349 160.111 19.1349ZM160.111 11.1946C159.723 11.1946 159.389 11.0549 159.109 10.7756C158.83 10.4962 158.69 10.1624 158.69 9.77415C158.69 9.38589 158.83 9.05445 159.109 8.77983C159.389 8.50047 159.723 8.3608 160.111 8.3608C160.499 8.3608 160.833 8.50047 161.112 8.77983C161.392 9.05445 161.531 9.38589 161.531 9.77415C161.531 10.0346 161.465 10.2737 161.332 10.4915C161.205 10.7045 161.034 10.875 160.821 11.0028C160.608 11.1307 160.371 11.1946 160.111 11.1946Z"
              fill="white"
            />
            <path
              d="M54.1539 31.6378C54.097 31.0649 53.8532 30.6198 53.4223 30.3026C52.9914 29.9853 52.4067 29.8267 51.6681 29.8267C51.1662 29.8267 50.7424 29.8977 50.3968 30.0398C50.0511 30.1771 49.786 30.3688 49.6013 30.6151C49.4214 30.8613 49.3314 31.1406 49.3314 31.4531C49.3219 31.7135 49.3764 31.9408 49.4948 32.1349C49.6179 32.3291 49.786 32.4972 49.999 32.6392C50.2121 32.7765 50.4583 32.8973 50.7377 33.0014C51.017 33.1009 51.3153 33.1861 51.6325 33.2571L52.9394 33.5696C53.5738 33.7116 54.1562 33.901 54.6865 34.1378C55.2168 34.3745 55.6761 34.6657 56.0644 35.0114C56.4526 35.357 56.7533 35.7642 56.9664 36.233C57.1842 36.7017 57.2954 37.2391 57.3002 37.8452C57.2954 38.7353 57.0682 39.5071 56.6183 40.1605C56.1733 40.8092 55.5293 41.3134 54.6865 41.6733C53.8485 42.0284 52.8376 42.206 51.6539 42.206C50.4796 42.206 49.4569 42.026 48.5857 41.6662C47.7192 41.3063 47.0421 40.7737 46.5544 40.0682C46.0715 39.358 45.8182 38.4796 45.7945 37.4332H48.7703C48.8035 37.9209 48.9432 38.3281 49.1894 38.6548C49.4403 38.9768 49.7741 39.2206 50.1908 39.3864C50.6122 39.5473 51.088 39.6278 51.6183 39.6278C52.1392 39.6278 52.5914 39.5521 52.9749 39.4006C53.3631 39.2491 53.6638 39.0384 53.8769 38.7685C54.0899 38.4986 54.1965 38.1884 54.1965 37.8381C54.1965 37.5114 54.0994 37.2367 53.9053 37.0142C53.7159 36.7917 53.4365 36.6023 53.0672 36.446C52.7026 36.2898 52.2552 36.1477 51.7249 36.0199L50.1411 35.6222C48.9147 35.3239 47.9465 34.8575 47.2362 34.223C46.526 33.5885 46.1733 32.7339 46.178 31.6591C46.1733 30.7784 46.4076 30.009 46.8811 29.3509C47.3593 28.6927 48.0151 28.179 48.8485 27.8097C49.6818 27.4403 50.6288 27.2557 51.6894 27.2557C52.7689 27.2557 53.7111 27.4403 54.5161 27.8097C55.3257 28.179 55.9555 28.6927 56.4053 29.3509C56.8551 30.009 57.0871 30.7713 57.1013 31.6378H54.1539ZM72.7352 34.7273C72.7352 36.3134 72.4345 37.6629 71.8332 38.7756C71.2366 39.8883 70.4222 40.7382 69.39 41.3253C68.3625 41.9077 67.2072 42.1989 65.9241 42.1989C64.6315 42.1989 63.4714 41.9053 62.444 41.3182C61.4165 40.7311 60.6045 39.8812 60.0079 38.7685C59.4113 37.6558 59.113 36.3087 59.113 34.7273C59.113 33.1411 59.4113 31.7917 60.0079 30.679C60.6045 29.5663 61.4165 28.7187 62.444 28.1364C63.4714 27.5492 64.6315 27.2557 65.9241 27.2557C67.2072 27.2557 68.3625 27.5492 69.39 28.1364C70.4222 28.7187 71.2366 29.5663 71.8332 30.679C72.4345 31.7917 72.7352 33.1411 72.7352 34.7273ZM69.6173 34.7273C69.6173 33.6998 69.4634 32.8333 69.1556 32.1278C68.8526 31.4223 68.4241 30.8873 67.8701 30.5227C67.3161 30.1581 66.6675 29.9759 65.9241 29.9759C65.1807 29.9759 64.532 30.1581 63.9781 30.5227C63.4241 30.8873 62.9932 31.4223 62.6855 32.1278C62.3824 32.8333 62.2309 33.6998 62.2309 34.7273C62.2309 35.7547 62.3824 36.6212 62.6855 37.3267C62.9932 38.0322 63.4241 38.5672 63.9781 38.9318C64.532 39.2964 65.1807 39.4787 65.9241 39.4787C66.6675 39.4787 67.3161 39.2964 67.8701 38.9318C68.4241 38.5672 68.8526 38.0322 69.1556 37.3267C69.4634 36.6212 69.6173 35.7547 69.6173 34.7273ZM83.9976 27.4545H87.0729V36.9006C87.0729 37.9612 86.8196 38.8892 86.3129 39.6847C85.8111 40.4801 85.1079 41.1004 84.2036 41.5455C83.2992 41.9858 82.2457 42.206 81.0431 42.206C79.8357 42.206 78.7798 41.9858 77.8754 41.5455C76.9711 41.1004 76.268 40.4801 75.7661 39.6847C75.2642 38.8892 75.0132 37.9612 75.0132 36.9006V27.4545H78.0885V36.6378C78.0885 37.1918 78.2093 37.6842 78.4507 38.1151C78.6969 38.5459 79.0426 38.8845 79.4877 39.1307C79.9327 39.3769 80.4512 39.5 81.0431 39.5C81.6396 39.5 82.1581 39.3769 82.5985 39.1307C83.0435 38.8845 83.3868 38.5459 83.6283 38.1151C83.8745 37.6842 83.9976 37.1918 83.9976 36.6378V27.4545ZM101.769 27.4545V42H99.113L92.7849 32.8452H92.6784V42H89.6031V27.4545H92.3019L98.5803 36.6023H98.7082V27.4545H101.769ZM109.466 42H104.31V27.4545H109.509C110.972 27.4545 112.232 27.7457 113.287 28.3281C114.343 28.9058 115.155 29.7367 115.723 30.821C116.296 31.9053 116.583 33.2027 116.583 34.7131C116.583 36.2282 116.296 37.5303 115.723 38.6193C115.155 39.7083 114.339 40.544 113.273 41.1264C112.213 41.7088 110.944 42 109.466 42ZM107.385 39.3651H109.339C110.248 39.3651 111.012 39.2041 111.633 38.8821C112.258 38.5554 112.726 38.0511 113.039 37.3693C113.356 36.6828 113.515 35.7973 113.515 34.7131C113.515 33.6383 113.356 32.7599 113.039 32.0781C112.726 31.3963 112.26 30.8944 111.64 30.5724C111.019 30.2505 110.255 30.0895 109.346 30.0895H107.385V39.3651ZM131.695 32.5469H128.584C128.527 32.1444 128.411 31.7869 128.236 31.4744C128.061 31.1572 127.836 30.8873 127.561 30.6648C127.287 30.4422 126.969 30.2718 126.609 30.1534C126.254 30.035 125.868 29.9759 125.452 29.9759C124.699 29.9759 124.043 30.1629 123.484 30.5369C122.926 30.9062 122.493 31.446 122.185 32.1562C121.877 32.8617 121.723 33.7187 121.723 34.7273C121.723 35.7642 121.877 36.6354 122.185 37.3409C122.497 38.0464 122.933 38.5791 123.492 38.9389C124.05 39.2988 124.697 39.4787 125.43 39.4787C125.842 39.4787 126.224 39.4242 126.574 39.3153C126.929 39.2064 127.244 39.0478 127.519 38.8395C127.793 38.6264 128.02 38.3684 128.2 38.0653C128.385 37.7623 128.513 37.4167 128.584 37.0284L131.695 37.0426C131.614 37.7102 131.413 38.3542 131.091 38.9744C130.774 39.59 130.345 40.1416 129.805 40.6293C129.27 41.1122 128.631 41.4957 127.888 41.7798C127.149 42.0592 126.314 42.1989 125.381 42.1989C124.083 42.1989 122.923 41.9053 121.901 41.3182C120.883 40.7311 120.078 39.8812 119.486 38.7685C118.899 37.6558 118.605 36.3087 118.605 34.7273C118.605 33.1411 118.903 31.7917 119.5 30.679C120.097 29.5663 120.906 28.7187 121.929 28.1364C122.952 27.5492 124.102 27.2557 125.381 27.2557C126.224 27.2557 127.005 27.3741 127.725 27.6108C128.449 27.8475 129.091 28.1932 129.649 28.6477C130.208 29.0975 130.662 29.6491 131.013 30.3026C131.368 30.956 131.595 31.7041 131.695 32.5469ZM133.9 42V27.4545H136.975V39.4645H143.211V42H133.9ZM158.048 34.7273C158.048 36.3134 157.747 37.6629 157.146 38.7756C156.549 39.8883 155.735 40.7382 154.703 41.3253C153.675 41.9077 152.52 42.1989 151.237 42.1989C149.944 42.1989 148.784 41.9053 147.756 41.3182C146.729 40.7311 145.917 39.8812 145.32 38.7685C144.724 37.6558 144.426 36.3087 144.426 34.7273C144.426 33.1411 144.724 31.7917 145.32 30.679C145.917 29.5663 146.729 28.7187 147.756 28.1364C148.784 27.5492 149.944 27.2557 151.237 27.2557C152.52 27.2557 153.675 27.5492 154.703 28.1364C155.735 28.7187 156.549 29.5663 157.146 30.679C157.747 31.7917 158.048 33.1411 158.048 34.7273ZM154.93 34.7273C154.93 33.6998 154.776 32.8333 154.468 32.1278C154.165 31.4223 153.737 30.8873 153.183 30.5227C152.629 30.1581 151.98 29.9759 151.237 29.9759C150.493 29.9759 149.845 30.1581 149.291 30.5227C148.737 30.8873 148.306 31.4223 147.998 32.1278C147.695 32.8333 147.543 33.6998 147.543 34.7273C147.543 35.7547 147.695 36.6212 147.998 37.3267C148.306 38.0322 148.737 38.5672 149.291 38.9318C149.845 39.2964 150.493 39.4787 151.237 39.4787C151.98 39.4787 152.629 39.2964 153.183 38.9318C153.737 38.5672 154.165 38.0322 154.468 37.3267C154.776 36.6212 154.93 35.7547 154.93 34.7273ZM169.31 27.4545H172.385V36.9006C172.385 37.9612 172.132 38.8892 171.625 39.6847C171.124 40.4801 170.42 41.1004 169.516 41.5455C168.612 41.9858 167.558 42.206 166.356 42.206C165.148 42.206 164.092 41.9858 163.188 41.5455C162.284 41.1004 161.58 40.4801 161.079 39.6847C160.577 38.8892 160.326 37.9612 160.326 36.9006V27.4545H163.401V36.6378C163.401 37.1918 163.522 37.6842 163.763 38.1151C164.009 38.5459 164.355 38.8845 164.8 39.1307C165.245 39.3769 165.764 39.5 166.356 39.5C166.952 39.5 167.471 39.3769 167.911 39.1307C168.356 38.8845 168.699 38.5459 168.941 38.1151C169.187 37.6842 169.31 37.1918 169.31 36.6378V27.4545ZM180.072 42H174.916V27.4545H180.114C181.578 27.4545 182.837 27.7457 183.893 28.3281C184.949 28.9058 185.761 29.7367 186.329 30.821C186.902 31.9053 187.188 33.2027 187.188 34.7131C187.188 36.2282 186.902 37.5303 186.329 38.6193C185.761 39.7083 184.944 40.544 183.879 41.1264C182.818 41.7088 181.549 42 180.072 42ZM177.991 39.3651H179.944C180.853 39.3651 181.618 39.2041 182.238 38.8821C182.863 38.5554 183.332 38.0511 183.644 37.3693C183.961 36.6828 184.12 35.7973 184.12 34.7131C184.12 33.6383 183.961 32.7599 183.644 32.0781C183.332 31.3963 182.865 30.8944 182.245 30.5724C181.625 30.2505 180.86 30.0895 179.951 30.0895H177.991V39.3651Z"
              fill="white"
            />
            <path
              d="M2.00894 33.4653C1.92181 33.4653 1.84878 33.5389 1.83469 33.6318L1.43495 37.3425L1.83469 40.9668C1.84878 41.061 1.92181 41.1359 2.00894 41.1359C2.09606 41.1359 2.16268 41.0623 2.17421 40.9668L2.60854 37.3425L2.14859 33.6318C2.14859 33.5389 2.07556 33.4653 1.99484 33.4653H2.00894ZM0.461235 34.8902C0.36002 34.8902 0.30749 34.9509 0.280585 35.0503L0 37.3425L0.280585 39.5883C0.280585 39.6903 0.361301 39.7574 0.43433 39.7574C0.515046 39.7574 0.588075 39.6761 0.613699 39.5754L0.973719 37.3038L0.613699 35.0115C0.613699 34.9031 0.54067 34.8567 0.461235 34.8567V34.8902ZM3.58354 32.7386C3.48232 32.7386 3.38239 32.82 3.38239 32.9193L3.02365 37.3296L3.40289 41.5579C3.40289 41.6573 3.48361 41.7657 3.60916 41.7657C3.71679 41.7657 3.78982 41.6573 3.81544 41.5579L4.24977 37.3025L3.81544 32.9129C3.78982 32.8135 3.7091 32.7115 3.60916 32.7115L3.58354 32.7386ZM5.22605 32.5567C5.09793 32.5567 4.99159 32.6586 4.96468 32.7928L4.63798 37.3309L4.99799 41.7141C5.02362 41.8419 5.12483 41.9477 5.25039 41.9477C5.37595 41.9477 5.48485 41.8406 5.50535 41.6935L5.91918 37.3309L5.50535 32.82C5.50586 32.7894 5.5004 32.7591 5.48928 32.7307C5.47816 32.7024 5.46159 32.6765 5.44053 32.6545C5.41948 32.6326 5.39433 32.6151 5.36655 32.6029C5.33876 32.5908 5.30887 32.5843 5.27858 32.5838L5.22605 32.5567ZM7.20039 33.1762C7.19675 33.1061 7.16628 33.0402 7.11539 32.9923C7.06449 32.9444 6.99714 32.9182 6.9275 32.9193C6.77375 32.9193 6.6546 33.0213 6.64691 33.1762L6.2728 37.3567L6.61232 41.767C6.61232 41.9219 6.74556 42.042 6.88522 42.042C7.01205 42.042 7.14018 41.9219 7.14018 41.767L7.52582 37.3567L7.14018 33.1491L7.20039 33.1762ZM8.58025 30.2386C8.49966 30.2405 8.4229 30.2737 8.36589 30.3311C8.30888 30.3885 8.276 30.4658 8.27405 30.547L7.91403 37.3567L8.23305 41.767C8.23305 41.9219 8.36629 42.0497 8.54054 42.0497C8.70069 42.0497 8.83393 41.8948 8.84803 41.7399L9.20164 37.3309L8.84803 30.4941C8.83393 30.3134 8.69428 30.1844 8.54054 30.1844L8.58025 30.2386ZM10.1766 28.6097C9.99727 28.6097 9.84353 28.7646 9.82943 28.9466L9.52194 37.3296L9.80253 41.7128C9.80253 41.9206 9.95627 42.0742 10.1369 42.0742C10.3163 42.0742 10.47 41.9206 10.4969 41.7128L10.8301 37.3296L10.4969 28.9724C10.47 28.7646 10.3163 28.6097 10.1433 28.6097H10.1766ZM11.832 27.8379C11.6257 27.8379 11.4719 27.9928 11.4438 28.1941L11.1632 37.2754L11.4438 41.6122C11.4707 41.8135 11.6244 42.0032 11.832 42.0032C11.9326 41.9987 12.0278 41.9557 12.0982 41.8831C12.1686 41.8105 12.209 41.7136 12.2112 41.6122L12.5456 37.2754L12.2112 28.1941C12.208 28.0937 12.1671 27.9982 12.0967 27.9271C12.0263 27.8559 11.9316 27.8143 11.832 27.8108V27.8379ZM13.9536 27.8843C13.9538 27.8306 13.9434 27.7773 13.9231 27.7276C13.9027 27.6779 13.8728 27.6327 13.8351 27.5947C13.7973 27.5566 13.7525 27.5265 13.7031 27.506C13.6538 27.4855 13.6009 27.475 13.5475 27.4752C13.3412 27.4752 13.1337 27.6572 13.1337 27.8843L12.8787 37.2496L13.1337 41.5592C13.1423 41.6714 13.1921 41.7762 13.2733 41.8533C13.3546 41.9304 13.4615 41.9742 13.5731 41.9761C13.6272 41.976 13.6807 41.965 13.7305 41.944C13.7804 41.9229 13.8256 41.8921 13.8636 41.8533C13.9016 41.8146 13.9316 41.7687 13.9519 41.7182C13.9721 41.6677 13.9823 41.6137 13.9818 41.5592L14.2624 37.2496L13.9818 27.865L13.9536 27.8843ZM15.2349 27.6572C15.1212 27.6607 15.0131 27.7076 14.9325 27.7883C14.8519 27.8691 14.8047 27.9777 14.8005 28.0921L14.5404 37.2561L14.8005 41.5102C14.8005 41.767 15.0004 41.9477 15.2349 41.9477C15.4693 41.9477 15.6692 41.7399 15.6692 41.4844L15.9293 37.2212L15.6423 28.0921C15.6426 28.0312 15.631 27.9708 15.608 27.9144C15.585 27.858 15.5511 27.8068 15.5083 27.7637C15.4655 27.7206 15.4147 27.6865 15.3587 27.6634C15.3028 27.6402 15.2428 27.6284 15.1823 27.6288L15.2349 27.6572ZM16.8966 27.9114C16.7683 27.9128 16.6458 27.9651 16.5556 28.0569C16.4654 28.1487 16.4148 28.2727 16.4148 28.4019L16.2355 37.2561L16.4699 41.5102C16.4697 41.5741 16.4823 41.6374 16.5068 41.6964C16.5314 41.7553 16.5674 41.8087 16.6128 41.8534C16.6582 41.898 16.7121 41.933 16.7712 41.9563C16.8302 41.9796 16.8934 41.9908 16.9568 41.989C17.2092 41.989 17.4167 41.7812 17.4372 41.4986L17.6435 37.2961L17.4167 28.4974C17.3975 28.2148 17.1849 28.007 16.9299 28.007L16.8966 27.9114ZM18.9516 26.3781C18.8651 26.3288 18.7673 26.3029 18.6679 26.3029C18.5684 26.3029 18.4706 26.3288 18.3841 26.3781C18.3086 26.4237 18.2457 26.4876 18.2011 26.5641C18.1566 26.6405 18.1318 26.727 18.1291 26.8157V26.9241L17.9561 37.3309L18.1496 41.545V41.5592C18.1594 41.6727 18.2037 41.7804 18.2764 41.8677C18.3273 41.9242 18.3891 41.9695 18.4581 42.0008C18.5271 42.0321 18.6018 42.0487 18.6775 42.0497C18.81 42.0427 18.9356 41.9877 19.0311 41.8948C19.1331 41.7907 19.1902 41.6501 19.1899 41.5037L19.2104 41.0946L19.4103 37.3038L19.1835 26.8298C19.1821 26.7475 19.1601 26.6669 19.1195 26.5954C19.079 26.5239 19.0213 26.4638 18.9516 26.4207V26.3781ZM20.6672 25.4372C20.6341 25.4034 20.5942 25.3771 20.5503 25.3599C20.5063 25.3428 20.4593 25.3353 20.4122 25.3378C20.2851 25.3342 20.1597 25.3688 20.0522 25.4372C19.9909 25.4882 19.9413 25.552 19.9068 25.6242C19.8723 25.6964 19.8537 25.7753 19.8523 25.8554V25.9018L19.6179 37.2754L19.746 39.3663L19.8523 41.4044C19.8586 41.55 19.9202 41.6877 20.0244 41.7888C20.1286 41.89 20.2675 41.9469 20.4122 41.9477C20.7197 41.9477 20.9721 41.6857 20.9721 41.376L21.2335 37.2212L20.9721 25.7999C20.9673 25.7035 20.9392 25.6098 20.8903 25.5268C20.8414 25.4438 20.7732 25.374 20.6915 25.3236L20.6672 25.4372ZM35.9546 31.8235C35.2678 31.8235 34.6003 31.972 34.0122 32.2275C33.8129 29.9992 32.7929 27.9267 31.1531 26.4178C29.5133 24.909 27.3723 24.0729 25.1514 24.0742C24.0227 24.0742 22.9157 24.3078 21.9215 24.6925C21.5333 24.8473 21.4602 25.0022 21.4346 25.3107V41.4302C21.4602 41.7399 21.687 42.0032 22.0022 42.029H35.9815C36.64 42.0354 37.2932 41.9098 37.9031 41.6597C38.5131 41.4096 39.0676 41.0399 39.5345 40.572C40.0015 40.1042 40.3714 39.5475 40.623 38.9344C40.8746 38.3213 41.0027 37.6639 41 37.0005C41.0016 36.3349 40.8732 35.6755 40.6219 35.0599C40.3706 34.4443 40.0014 33.8846 39.5354 33.4127C39.0694 32.9409 38.5157 32.5661 37.9059 32.3098C37.2961 32.0535 36.6422 31.9207 35.9815 31.919L35.9546 31.8235Z"
              fill="white"
            />
          </svg>
        </div>

        <h3 class="text-lg font-semibold mb-3 text-white">Song Credits</h3>

        <!-- Song Credits List -->
        <div class="space-y-3">
          {#each words as word}
            <div
              onclick={() => openTrackInSoundCloud(word.audioUrl)}
              class="bg-white rounded-lg p-4 flex items-center justify-between cursor-pointer hover:bg-gray-50 transition-colors"
            >
              <div class="flex items-center gap-4">
                <button
                  onclick={(e) => {
                    e.stopPropagation();
                    playTrackPreview(word);
                  }}
                  class="text-gray-600 hover:text-gray-800 transition-colors"
                  aria-label="Play preview"
                >
                  <svg
                    width="40"
                    height="40"
                    viewBox="0 0 20 20"
                    fill="none"
                    xmlns="http://www.w3.org/2000/svg"
                  >
                    <path
                      d="M10 0C8.02219 0 6.08879 0.58649 4.4443 1.6853C2.79981 2.78412 1.51809 4.3459 0.761209 6.17317C0.00433284 8.00043 -0.193701 10.0111 0.192152 11.9509C0.578004 13.8907 1.53041 15.6725 2.92894 17.0711C4.32746 18.4696 6.10929 19.422 8.0491 19.8079C9.98891 20.1937 11.9996 19.9957 13.8268 19.2388C15.6541 18.4819 17.2159 17.2002 18.3147 15.5557C19.4135 13.9112 20 11.9778 20 10C20 8.68678 19.7413 7.38642 19.2388 6.17317C18.7363 4.95991 17.9997 3.85752 17.0711 2.92893C16.1425 2.00035 15.0401 1.26375 13.8268 0.761205C12.6136 0.258658 11.3132 0 10 0ZM8 14.5V5.5L14 10L8 14.5Z"
                      fill="#FF3F00"
                    />
                  </svg>
                </button>
                <div class="flex flex-col">
                  <p class="text-gray-800 font-medium">{word.text}</p>
                  {#if trackMetadata[word.audioUrl]?.title && trackMetadata[word.audioUrl]?.artist}
                    <div class="flex flex-col">
                      <p class="text-gray-800 font-semibold text-sm">
                        {trackMetadata[word.audioUrl].title}
                      </p>
                      <p class="text-gray-500 text-xs">
                        {trackMetadata[word.audioUrl].artist}
                      </p>
                    </div>
                  {:else}
                    <p class="text-gray-600 text-sm">Loading track info...</p>
                  {/if}
                </div>
              </div>
              <div>
                <svg
                  width="41"
                  height="18"
                  viewBox="0 0 41 18"
                  fill="none"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <path
                    d="M2.00893 9.39108C1.92181 9.39108 1.84878 9.46465 1.83469 9.55758L1.43495 13.2683L1.83469 16.8926C1.84878 16.9868 1.92181 17.0617 2.00893 17.0617C2.09606 17.0617 2.16268 16.9881 2.17421 16.8926L2.60854 13.2683L2.14859 9.55758C2.14859 9.46465 2.07556 9.39108 1.99484 9.39108H2.00893ZM0.461235 10.816C0.36002 10.816 0.30749 10.8767 0.280585 10.9761L0 13.2683L0.280585 15.5141C0.280585 15.6161 0.361301 15.6832 0.43433 15.6832C0.515046 15.6832 0.588075 15.6019 0.613699 15.5012L0.973719 13.2296L0.613699 10.9373C0.613699 10.8289 0.54067 10.7824 0.461235 10.7824V10.816ZM3.58354 8.66442C3.48232 8.66442 3.38239 8.74573 3.38239 8.84512L3.02365 13.2554L3.40289 17.4837C3.40289 17.5831 3.48361 17.6915 3.60916 17.6915C3.71679 17.6915 3.78982 17.5831 3.81544 17.4837L4.24977 13.2283L3.81544 8.83866C3.78982 8.73928 3.7091 8.63732 3.60916 8.63732L3.58354 8.66442ZM5.22605 8.48243C5.09793 8.48243 4.99159 8.5844 4.96468 8.71863L4.63798 13.2567L4.99799 17.6399C5.02362 17.7677 5.12483 17.8735 5.25039 17.8735C5.37595 17.8735 5.48485 17.7664 5.50535 17.6192L5.91918 13.2567L5.50535 8.74574C5.50586 8.71522 5.5004 8.68491 5.48928 8.65653C5.47816 8.62814 5.46159 8.60225 5.44053 8.58031C5.41948 8.55838 5.39433 8.54084 5.36655 8.5287C5.33876 8.51655 5.30887 8.51004 5.27858 8.50954L5.22605 8.48243ZM7.20039 9.10197C7.19675 9.03189 7.16628 8.96598 7.11539 8.91807C7.06449 8.87017 6.99714 8.84402 6.9275 8.84512C6.77375 8.84512 6.6546 8.94708 6.64691 9.10197L6.2728 13.2825L6.61232 17.6928C6.61232 17.8477 6.74556 17.9677 6.88522 17.9677C7.01205 17.9677 7.14018 17.8477 7.14018 17.6928L7.52582 13.2825L7.14018 9.07486L7.20039 9.10197ZM8.58025 6.16435C8.49966 6.16631 8.4229 6.19945 8.36589 6.25688C8.30888 6.3143 8.276 6.39163 8.27405 6.47282L7.91403 13.2825L8.23305 17.6928C8.23305 17.8477 8.36629 17.9755 8.54054 17.9755C8.70069 17.9755 8.83393 17.8206 8.84803 17.6657L9.20164 13.2567L8.84803 6.41991C8.83393 6.23921 8.69428 6.11014 8.54054 6.11014L8.58025 6.16435ZM10.1766 4.5355C9.99727 4.5355 9.84353 4.69038 9.82943 4.87237L9.52194 13.2554L9.80253 17.6386C9.80253 17.8464 9.95627 18 10.1369 18C10.3163 18 10.47 17.8464 10.4969 17.6386L10.8301 13.2554L10.4969 4.89818C10.47 4.69038 10.3163 4.5355 10.1433 4.5355H10.1766ZM11.832 3.76366C11.6257 3.76366 11.4719 3.91854 11.4438 4.11989L11.1632 13.2012L11.4438 17.5379C11.4707 17.7393 11.6244 17.929 11.832 17.929C11.9326 17.9245 12.0278 17.8815 12.0982 17.8089C12.1686 17.7363 12.209 17.6394 12.2112 17.5379L12.5456 13.2012L12.2112 4.11989C12.208 4.01946 12.1671 3.92401 12.0967 3.85284C12.0263 3.78167 11.9316 3.74011 11.832 3.73656V3.76366ZM13.9536 3.81013C13.9538 3.75635 13.9434 3.70307 13.9231 3.65335C13.9027 3.60363 13.8728 3.55846 13.8351 3.52043C13.7973 3.48241 13.7525 3.45228 13.7031 3.43177C13.6538 3.41127 13.6009 3.40081 13.5475 3.40098C13.3412 3.40098 13.1337 3.58296 13.1337 3.81013L12.8787 13.1754L13.1337 41.5592C13.1423 41.6714 13.1921 41.7762 13.2733 41.8533C13.3546 41.9304 13.4615 41.9742 13.5731 41.9761C13.6272 41.976 13.6807 41.965 13.7305 41.944C13.7804 41.9229 13.8256 41.8921 13.8636 41.8533C13.9016 41.8146 13.9316 41.7687 13.9519 41.7182C13.9721 41.6677 13.9823 41.6137 13.9818 41.5592L14.2624 37.2496L13.9818 27.865L13.9536 27.8843ZM15.2349 27.6572C15.1212 27.6607 15.0131 27.7076 14.9325 27.7883C14.8519 27.8691 14.8047 27.9777 14.8005 28.0921L14.5404 37.2561L14.8005 41.5102C14.8005 41.767 15.0004 41.9477 15.2349 41.9477C15.4693 41.9477 15.6692 41.7399 15.6692 41.4844L15.9293 37.2212L15.6423 28.0921C15.6426 28.0312 15.631 27.9708 15.608 27.9144C15.585 27.858 15.5511 27.8068 15.5083 27.7637C15.4655 27.7206 15.4147 27.6865 15.3587 27.6634C15.3028 27.6402 15.2428 27.6284 15.1823 27.6288L15.2349 27.6572ZM16.8966 27.9114C16.7683 27.9128 16.6458 27.9651 16.5556 28.0569C16.4654 28.1487 16.4148 28.2727 16.4148 28.4019L16.2355 37.2561L16.4699 41.5102C16.4697 41.5741 16.4823 41.6374 16.5068 41.6964C16.5314 41.7553 16.5674 41.8087 16.6128 41.8534C16.6582 41.898 16.7121 41.933 16.7712 41.9563C16.8302 41.9796 16.8934 41.9908 16.9568 41.989C17.2092 41.989 17.4167 41.7812 17.4372 41.4986L17.6435 37.2961L17.4167 28.4974C17.3975 28.2148 17.1849 28.007 16.9299 28.007L16.8966 27.9114ZM18.9516 26.3781C18.8651 26.3288 18.7673 26.3029 18.6679 26.3029C18.5684 26.3029 18.4706 26.3288 18.3841 26.3781C18.3086 26.4237 18.2457 26.4876 18.2011 26.5641C18.1566 26.6405 18.1318 26.727 18.1291 26.8157V26.9241L17.9561 37.3309L18.1496 41.545V41.5592C18.1594 41.6727 18.2037 41.7804 18.2764 41.8677C18.3273 41.9242 18.3891 41.9695 18.4581 42.0008C18.5271 42.0321 18.6018 42.0487 18.6775 42.0497C18.81 42.0427 18.9356 41.9877 19.0311 41.8948C19.1331 41.7907 19.1902 41.6501 19.1899 41.5037L19.2104 41.0946L19.4103 37.3038L19.1835 26.8298C19.1821 26.7475 19.1601 26.6669 19.1195 26.5954C19.079 26.5239 19.0213 26.4638 18.9516 26.4207V26.3781ZM20.6672 25.4372C20.6341 25.4034 20.5942 25.3771 20.5503 25.3599C20.5063 25.3428 20.4593 25.3353 20.4122 25.3378C20.2851 25.3342 20.1597 25.3688 20.0522 25.4372C19.9909 25.4882 19.9413 25.552 19.9068 25.6242C19.8723 25.6964 19.8537 25.7753 19.8523 25.8554V25.9018L19.6179 37.2754L19.746 39.3663L19.8523 41.4044C19.8586 41.55 19.9202 41.6877 20.0244 41.7888C20.1286 41.89 20.2675 41.9469 20.4122 41.9477C20.7197 41.9477 20.9721 41.6857 20.9721 41.376L21.2335 37.2212L20.9721 25.7999C20.9673 25.7035 20.9392 25.6098 20.8903 25.5268C20.8414 25.4438 20.7732 25.374 20.6915 25.3236L20.6672 25.4372ZM35.9546 31.8235C35.2678 31.8235 34.6003 31.972 34.0122 32.2275C33.8129 29.9992 32.7929 27.9267 31.1531 26.4178C29.5133 24.909 27.3723 24.0729 25.1514 24.0742C24.0227 24.0742 22.9157 24.3078 21.9215 24.6925C21.5333 24.8473 21.4602 25.0022 21.4346 25.3107V41.4302C21.4602 41.7399 21.687 42.0032 22.0022 42.029H35.9815C36.64 42.0354 37.2932 41.9098 37.9031 41.6597C38.5131 41.4096 39.0676 41.0399 39.5345 40.572C40.0015 40.1042 40.3714 39.5475 40.623 38.9344C40.8746 38.3213 41.0027 37.6639 41 37.0005C41.0016 36.3349 40.8732 35.6755 40.6219 35.0599C40.3706 34.4443 40.0014 33.8846 39.5354 33.4127C39.0694 32.9409 38.5157 32.5661 37.9059 32.3098C37.2961 32.0535 36.6422 31.9207 35.9815 31.919L35.9546 31.8235Z"
                    fill="#FF3F00"
                  />
                </svg>
              </div>
            </div>
          {/each}
        </div>
      </div>
      <!-- END: SoundCloud Attribution Section -->
    </div>

    <!-- Footer attribution -->
    <div class="absolute left-4 bottom-4 text-xs text-gray-600">
      Audio provided by SoundCloud
    </div>

    <!-- Share message -->
    {#if showShareMessage}
      <div
        class="fixed bottom-4 right-4 bg-yellow-200 text-yellow-800 p-4 rounded shadow-lg z-50"
      >
        <p>Text copied to clipboard!</p>
        <button
          onclick={() => (showShareMessage = false)}
          class="mt-2 text-sm underline"
        >
          Dismiss
        </button>
      </div>
    {/if}
  {:else}
    <!-- Incorrect answer overlay -->
    <div class="absolute inset-0 bg-gray-500/50 backdrop-blur-[2px]"></div>

    <div
      class="bg-white rounded-lg p-6 max-w-sm relative shadow-lg border border-gray-200"
    >
      <button
        onclick={onClose}
        class="absolute top-2 right-2 text-gray-500 hover:text-gray-700"
        aria-label="Close"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          class="h-6 w-6"
          fill="none"
          viewBox="0 0 24 24"
          stroke="currentColor"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M6 18L18 6M6 6l12 12"
          />
        </svg>
      </button>

      <div class="text-center mt-4">
        <h2 class="text-xl font-bold text-red-600 mb-4">
          At least one square is wrong.
        </h2>
        <button
          onclick={onClose}
          class="bg-blue-500 text-white px-6 py-2 rounded-lg hover:bg-blue-600 transition-colors"
        >
          KEEP TRYING
        </button>
      </div>
    </div>
  {/if}
</div>
